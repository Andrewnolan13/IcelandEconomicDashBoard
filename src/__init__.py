import sqlite3
import os
from multiprocessing import current_process 

from .api import StatisticsIcelandAPI
from .constants import SOURCE

print(current_process().name)

if current_process().name == "MainProcess": 

    #make data directory if not exists
    os.makedirs(SOURCE.DATA.str, exist_ok=True)

    # create if not exists the database
    conn = sqlite3.connect(SOURCE.DATA.DB.str)
    c = conn.cursor()

    # Write ahead logging mode for multiple readers and writing
    conn.execute("PRAGMA journal_mode=WAL;")

    #create if not exists various tables
    c.execute("""
    CREATE TABLE IF NOT EXISTS REQUESTS (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        url TEXT NOT NULL,
        call_weight REAL NOT NULL,
        timestamp TEXT DEFAULT CURRENT_TIMESTAMP
    );
    """)

    c.execute('DROP TABLE IF EXISTS CPI;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS CPI (
        "Month" TEXT,
        "Consumer price index Index" REAL,
        "Consumer price index Monthly change, %" TEXT,
        "Consumer price index Annual change, %" TEXT,
        "Consumer price index Annualized rate, latest month, %" TEXT,
        "Consumer price index Annualized rate, 3 month, %" TEXT,
        "Consumer price index Annualized rate,  6 month, %" TEXT,
        "Consumer price index less housing cost Index" REAL,
        "Consumer price index less housing cost Monthly change, %" TEXT,
        "Consumer price index less housing cost Annual change, %" TEXT,
        "Consumer price index less housing cost Annualized rate, latest month, %" TEXT,
        "Consumer price index less housing cost Annualized rate, 3 month, %" TEXT,
        "Consumer price index less housing cost Annualized rate,  6 month, %" TEXT
    );''')

    c.execute('DROP TABLE IF EXISTS Interest;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS Interest (
        "Year" INTEGER,
        "General savings deposits Nominal interest, % per year" REAL,
        "General savings deposits Real interest, % per year" REAL,
        "Time deposits Nominal interest, % per year" REAL,
        "Time deposits Real interest, % per year" REAL,
        "Bills of exchange 60 days Nominal interest, % per year" REAL,
        "Bills of exchange 60 days Real interest, % per year" REAL,
        "General loans, bonds Nominal interest, % per year" REAL,
        "General loans, bonds Real interest, % per year" REAL,
        "Indexed securities Nominal interest, % per year" TEXT,
        "Indexed securities Real interest, % per year" TEXT,
        "Penalty rates Nominal interest, % per year" TEXT,
        "Penalty rates Real interest, % per year" TEXT
    );''')

    c.execute('DROP TABLE IF EXISTS Employment;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS Employment (
        "Value unit" TEXT,
        "Employment" TEXT,
        "Economic activity" TEXT,
        "1991Q1" INTEGER,
        "1991Q2" INTEGER,
        "1991Q3" INTEGER,
        "1991Q4" INTEGER,
        "1992Q1" INTEGER,
        "1992Q2" INTEGER,
        "1992Q3" INTEGER,
        "1992Q4" INTEGER,
        "1993Q1" INTEGER,
        "1993Q2" INTEGER,
        "1993Q3" INTEGER,
        "1993Q4" INTEGER,
        "1994Q1" INTEGER,
        "1994Q2" INTEGER,
        "1994Q3" INTEGER,
        "1994Q4" INTEGER,
        "1995Q1" INTEGER,
        "1995Q2" INTEGER,
        "1995Q3" INTEGER,
        "1995Q4" INTEGER,
        "1996Q1" INTEGER,
        "1996Q2" INTEGER,
        "1996Q3" INTEGER,
        "1996Q4" INTEGER,
        "1997Q1" INTEGER,
        "1997Q2" INTEGER,
        "1997Q3" INTEGER,
        "1997Q4" INTEGER,
        "1998Q1" INTEGER,
        "1998Q2" INTEGER,
        "1998Q3" INTEGER,
        "1998Q4" INTEGER,
        "1999Q1" INTEGER,
        "1999Q2" INTEGER,
        "1999Q3" INTEGER,
        "1999Q4" INTEGER,
        "2000Q1" INTEGER,
        "2000Q2" INTEGER,
        "2000Q3" INTEGER,
        "2000Q4" INTEGER,
        "2001Q1" INTEGER,
        "2001Q2" INTEGER,
        "2001Q3" INTEGER,
        "2001Q4" INTEGER,
        "2002Q1" INTEGER,
        "2002Q2" INTEGER,
        "2002Q3" INTEGER,
        "2002Q4" INTEGER,
        "2003Q1" INTEGER,
        "2003Q2" INTEGER,
        "2003Q3" INTEGER,
        "2003Q4" INTEGER,
        "2004Q1" INTEGER,
        "2004Q2" INTEGER,
        "2004Q3" INTEGER,
        "2004Q4" INTEGER,
        "2005Q1" INTEGER,
        "2005Q2" INTEGER,
        "2005Q3" INTEGER,
        "2005Q4" INTEGER,
        "2006Q1" INTEGER,
        "2006Q2" INTEGER,
        "2006Q3" INTEGER,
        "2006Q4" INTEGER,
        "2007Q1" INTEGER,
        "2007Q2" INTEGER,
        "2007Q3" INTEGER,
        "2007Q4" INTEGER,
        "2008Q1" INTEGER,
        "2008Q2" INTEGER,
        "2008Q3" INTEGER,
        "2008Q4" INTEGER,
        "2009Q1" INTEGER,
        "2009Q2" INTEGER,
        "2009Q3" INTEGER,
        "2009Q4" INTEGER,
        "2010Q1" INTEGER,
        "2010Q2" INTEGER,
        "2010Q3" INTEGER,
        "2010Q4" INTEGER,
        "2011Q1" INTEGER,
        "2011Q2" INTEGER,
        "2011Q3" INTEGER,
        "2011Q4" INTEGER,
        "2012Q1" INTEGER,
        "2012Q2" INTEGER,
        "2012Q3" INTEGER,
        "2012Q4" INTEGER,
        "2013Q1" INTEGER,
        "2013Q2" INTEGER,
        "2013Q3" INTEGER,
        "2013Q4" INTEGER,
        "2014Q1" INTEGER,
        "2014Q2" INTEGER,
        "2014Q3" INTEGER,
        "2014Q4" INTEGER,
        "2015Q1" INTEGER,
        "2015Q2" INTEGER,
        "2015Q3" INTEGER,
        "2015Q4" INTEGER,
        "2016Q1" INTEGER,
        "2016Q2" INTEGER,
        "2016Q3" INTEGER,
        "2016Q4" INTEGER,
        "2017Q1" INTEGER,
        "2017Q2" INTEGER,
        "2017Q3" INTEGER,
        "2017Q4" INTEGER,
        "2018Q1" INTEGER,
        "2018Q2" INTEGER,
        "2018Q3" INTEGER,
        "2018Q4" INTEGER,
        "2019Q1" INTEGER,
        "2019Q2" INTEGER,
        "2019Q3" INTEGER,
        "2019Q4" INTEGER,
        "2020Q1" INTEGER,
        "2020Q2" INTEGER,
        "2020Q3" INTEGER,
        "2020Q4" INTEGER,
        "2021Q1" INTEGER,
        "2021Q2" INTEGER,
        "2021Q3" INTEGER,
        "2021Q4" INTEGER,
        "2022Q1" INTEGER,
        "2022Q2" INTEGER,
        "2022Q3" INTEGER,
        "2022Q4" INTEGER,
        "2023Q1" INTEGER,
        "2023Q2" INTEGER,
        "2023Q3" INTEGER,
        "2023Q4" INTEGER,
        "2024Q1" INTEGER,
        "2024Q2" INTEGER,
        "2024Q3" INTEGER,
        "2024Q4" INTEGER
    );''')

    c.execute('DROP TABLE IF EXISTS GDP;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS GDP (
        "Value unit" TEXT,
        "Category" TEXT,
        "1995Q1" TEXT,
        "1995Q2" TEXT,
        "1995Q3" TEXT,
        "1995Q4" TEXT,
        "1996Q1" TEXT,
        "1996Q2" TEXT,
        "1996Q3" TEXT,
        "1996Q4" TEXT,
        "1997Q1" TEXT,
        "1997Q2" TEXT,
        "1997Q3" TEXT,
        "1997Q4" TEXT,
        "1998Q1" TEXT,
        "1998Q2" TEXT,
        "1998Q3" TEXT,
        "1998Q4" TEXT,
        "1999Q1" TEXT,
        "1999Q2" TEXT,
        "1999Q3" TEXT,
        "1999Q4" TEXT,
        "2000Q1" TEXT,
        "2000Q2" TEXT,
        "2000Q3" TEXT,
        "2000Q4" TEXT,
        "2001Q1" TEXT,
        "2001Q2" TEXT,
        "2001Q3" TEXT,
        "2001Q4" TEXT,
        "2002Q1" TEXT,
        "2002Q2" TEXT,
        "2002Q3" TEXT,
        "2002Q4" TEXT,
        "2003Q1" TEXT,
        "2003Q2" TEXT,
        "2003Q3" TEXT,
        "2003Q4" TEXT,
        "2004Q1" TEXT,
        "2004Q2" TEXT,
        "2004Q3" TEXT,
        "2004Q4" TEXT,
        "2005Q1" TEXT,
        "2005Q2" TEXT,
        "2005Q3" TEXT,
        "2005Q4" TEXT,
        "2006Q1" TEXT,
        "2006Q2" TEXT,
        "2006Q3" TEXT,
        "2006Q4" TEXT,
        "2007Q1" TEXT,
        "2007Q2" TEXT,
        "2007Q3" TEXT,
        "2007Q4" TEXT,
        "2008Q1" TEXT,
        "2008Q2" TEXT,
        "2008Q3" TEXT,
        "2008Q4" TEXT,
        "2009Q1" TEXT,
        "2009Q2" TEXT,
        "2009Q3" TEXT,
        "2009Q4" TEXT,
        "2010Q1" TEXT,
        "2010Q2" TEXT,
        "2010Q3" TEXT,
        "2010Q4" TEXT,
        "2011Q1" TEXT,
        "2011Q2" TEXT,
        "2011Q3" TEXT,
        "2011Q4" TEXT,
        "2012Q1" TEXT,
        "2012Q2" TEXT,
        "2012Q3" TEXT,
        "2012Q4" TEXT,
        "2013Q1" TEXT,
        "2013Q2" TEXT,
        "2013Q3" TEXT,
        "2013Q4" TEXT,
        "2014Q1" TEXT,
        "2014Q2" TEXT,
        "2014Q3" TEXT,
        "2014Q4" TEXT,
        "2015Q1" TEXT,
        "2015Q2" TEXT,
        "2015Q3" TEXT,
        "2015Q4" TEXT,
        "2016Q1" TEXT,
        "2016Q2" TEXT,
        "2016Q3" TEXT,
        "2016Q4" TEXT,
        "2017Q1" TEXT,
        "2017Q2" TEXT,
        "2017Q3" TEXT,
        "2017Q4" TEXT,
        "2018Q1" TEXT,
        "2018Q2" TEXT,
        "2018Q3" TEXT,
        "2018Q4" TEXT,
        "2019Q1" TEXT,
        "2019Q2" TEXT,
        "2019Q3" TEXT,
        "2019Q4" TEXT,
        "2020Q1" TEXT,
        "2020Q2" TEXT,
        "2020Q3" TEXT,
        "2020Q4" TEXT,
        "2021Q1" TEXT,
        "2021Q2" TEXT,
        "2021Q3" TEXT,
        "2021Q4" TEXT,
        "2022Q1" TEXT,
        "2022Q2" TEXT,
        "2022Q3" TEXT,
        "2022Q4" TEXT,
        "2023Q1" TEXT,
        "2023Q2" TEXT,
        "2023Q3" TEXT,
        "2023Q4" TEXT,
        "2024Q1" TEXT,
        "2024Q2" TEXT,
        "2024Q3" TEXT,
        "2024Q4" TEXT
    );''')

    c.execute('DROP TABLE IF EXISTS Flux;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS Flux (
        "Quarter" TEXT,
        "Event" TEXT,
        "Total Total" INTEGER,
        "Total Males" INTEGER,
        "Total Females" INTEGER,
        "Total Icelandic citizens" INTEGER,
        "Total Foreign citizens" INTEGER,
        "Capital region Total" INTEGER,
        "Capital region Males" INTEGER,
        "Capital region Females" INTEGER,
        "Capital region Icelandic citizens" INTEGER,
        "Capital region Foreign citizens" INTEGER,
        "Other regions Total" INTEGER,
        "Other regions Males" INTEGER,
        "Other regions Females" INTEGER,
        "Other regions Icelandic citizens" INTEGER,
        "Other regions Foreign citizens" TEXT
    );''')


    c.execute('DROP TABLE IF EXISTS Population_by_municipality;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS Population_by_municipality (
        "Quarter" TEXT,
        "Municipality" TEXT,
        "Total" INTEGER,
        "Males" INTEGER,
        "Females" INTEGER,
        "Non-binary/Other" TEXT,
        "Icelandic citizens" INTEGER,
        "Foreign citizens" TEXT
    );''')


    c.execute('DROP TABLE IF EXISTS Population;')
    c.execute(
    '''
    CREATE TABLE IF NOT EXISTS Population (
        "Sex" TEXT,
        "Age" TEXT,
        "1841" TEXT,
        "1842" TEXT,
        "1843" TEXT,
        "1844" TEXT,
        "1845" TEXT,
        "1846" TEXT,
        "1847" TEXT,
        "1848" TEXT,
        "1849" TEXT,
        "1850" TEXT,
        "1851" TEXT,
        "1852" TEXT,
        "1853" TEXT,
        "1854" TEXT,
        "1855" TEXT,
        "1856" TEXT,
        "1857" TEXT,
        "1858" TEXT,
        "1859" TEXT,
        "1860" TEXT,
        "1861" TEXT,
        "1862" TEXT,
        "1863" TEXT,
        "1864" TEXT,
        "1865" TEXT,
        "1866" TEXT,
        "1867" TEXT,
        "1868" TEXT,
        "1869" TEXT,
        "1870" TEXT,
        "1871" TEXT,
        "1872" TEXT,
        "1873" TEXT,
        "1874" TEXT,
        "1875" TEXT,
        "1876" TEXT,
        "1877" TEXT,
        "1878" TEXT,
        "1879" TEXT,
        "1880" TEXT,
        "1881" TEXT,
        "1882" TEXT,
        "1883" TEXT,
        "1884" TEXT,
        "1885" TEXT,
        "1886" TEXT,
        "1887" TEXT,
        "1888" TEXT,
        "1889" TEXT,
        "1890" TEXT,
        "1891" TEXT,
        "1892" TEXT,
        "1893" TEXT,
        "1894" TEXT,
        "1895" TEXT,
        "1896" TEXT,
        "1897" TEXT,
        "1898" TEXT,
        "1899" TEXT,
        "1900" TEXT,
        "1901" TEXT,
        "1902" TEXT,
        "1903" TEXT,
        "1904" TEXT,
        "1905" TEXT,
        "1906" TEXT,
        "1907" TEXT,
        "1908" TEXT,
        "1909" TEXT,
        "1910" TEXT,
        "1911" TEXT,
        "1912" TEXT,
        "1913" TEXT,
        "1914" TEXT,
        "1915" TEXT,
        "1916" TEXT,
        "1917" TEXT,
        "1918" TEXT,
        "1919" TEXT,
        "1920" TEXT,
        "1921" TEXT,
        "1922" TEXT,
        "1923" TEXT,
        "1924" TEXT,
        "1925" TEXT,
        "1926" TEXT,
        "1927" TEXT,
        "1928" TEXT,
        "1929" TEXT,
        "1930" TEXT,
        "1931" TEXT,
        "1932" TEXT,
        "1933" TEXT,
        "1934" TEXT,
        "1935" TEXT,
        "1936" TEXT,
        "1937" TEXT,
        "1938" TEXT,
        "1939" TEXT,
        "1940" TEXT,
        "1941" TEXT,
        "1942" TEXT,
        "1943" TEXT,
        "1944" TEXT,
        "1945" TEXT,
        "1946" TEXT,
        "1947" TEXT,
        "1948" TEXT,
        "1949" TEXT,
        "1950" TEXT,
        "1951" TEXT,
        "1952" TEXT,
        "1953" TEXT,
        "1954" TEXT,
        "1955" TEXT,
        "1956" TEXT,
        "1957" TEXT,
        "1958" TEXT,
        "1959" TEXT,
        "1960" TEXT,
        "1961" TEXT,
        "1962" TEXT,
        "1963" TEXT,
        "1964" TEXT,
        "1965" TEXT,
        "1966" TEXT,
        "1967" TEXT,
        "1968" TEXT,
        "1969" TEXT,
        "1970" TEXT,
        "1971" TEXT,
        "1972" TEXT,
        "1973" TEXT,
        "1974" TEXT,
        "1975" TEXT,
        "1976" TEXT,
        "1977" TEXT,
        "1978" TEXT,
        "1979" TEXT,
        "1980" TEXT,
        "1981" TEXT,
        "1982" TEXT,
        "1983" TEXT,
        "1984" TEXT,
        "1985" TEXT,
        "1986" TEXT,
        "1987" TEXT,
        "1988" TEXT,
        "1989" TEXT,
        "1990" TEXT,
        "1991" TEXT,
        "1992" TEXT,
        "1993" TEXT,
        "1994" TEXT,
        "1995" TEXT,
        "1996" TEXT,
        "1997" TEXT,
        "1998" TEXT,
        "1999" TEXT,
        "2000" TEXT,
        "2001" TEXT,
        "2002" TEXT,
        "2003" TEXT,
        "2004" TEXT,
        "2005" TEXT,
        "2006" TEXT,
        "2007" TEXT,
        "2008" TEXT,
        "2009" TEXT,
        "2010" TEXT,
        "2011" TEXT,
        "2012" TEXT,
        "2013" TEXT,
        "2014" TEXT,
        "2015" TEXT,
        "2016" TEXT,
        "2017" TEXT,
        "2018" TEXT,
        "2019" TEXT,
        "2020" TEXT,
        "2021" TEXT,
        "2022" INTEGER,
        "2023" INTEGER,
        "2024" INTEGER,
        "2025" INTEGER
    );''')

    conn.commit()
    conn.close()